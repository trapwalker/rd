<!DOCTYPE html>
<html>
<head>
    <!--<meta http-equiv="Content-Security-Policy" content="default-src 'self' data: gap: https://ssl.gstatic.com 'unsafe-eval'; style-src 'self' 'unsafe-inline'; media-src *">-->
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
    <!--<link rel="stylesheet" type="text/css" href="css/index.css">-->
    <script src="http://192.168.1.104/static/js/third_party/jquery.min.js"></script>

</head>
<body onload="body_on_load()"></body>

<script>
	function body_on_load() {
        var header_ready = false;
        var content_ready = false;

        var host_links = [
            'http://192.168.1.105/',
            'http://192.168.1.104/',
            'http://192.168.1.6/',
            'http://roaddogs.ru/'
        ];

        function client_ready_call() {setTimeout(function () { client_ready(); }, 500); }

        function next_link() {
            host_links.shift();
            if (host_links.length)
                get_header_and_content(host_links[0]);
            else {
                alert('Error. All servers not available.')
            }
        }

        function get_header_and_content(link) {
            var data_header = null;
            var data_content = null;
            var count = 0;

            function ready() {
                headerGeted(data_header);
                contentGeted(data_content);
            }

            function getHeader(link_header) {
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function () {
                    if (xhttp.readyState != 4) return;
                    count++;
                    if (xhttp.status == 200) {
                        data_header = xhttp.responseText;
                        if (data_header && data_content) ready();
                    }
                    else {
                        if (count == 2) next_link();
                    }
                };
                xhttp.open("GET", link_header, true);
                xhttp.send();
            }

            function getContent(link_content) {
                var xhttp2 = new XMLHttpRequest();
                xhttp2.onreadystatechange = function () {
                    if (xhttp2.readyState != 4) return;
                    count++;
                    if (xhttp2.status == 200) {
                        data_content = xhttp2.responseText;
                        if (data_header && data_content) ready();
                    }
                    else {
                        if (count == 2) next_link();
                    }
                };
                xhttp2.open("GET", link_content, true);
                xhttp2.send();
            }

            getHeader(link + 'play/mobile/header');
            getContent(link + 'play/mobile/content');

        }


        function headerGeted(data) {
            var l = data.split('\n');
            var time_out = 100;
            var ii = 0;
            for (var i = 0; i < l.length; i++) {
                setTimeout(function () {
                    if (l[ii].includes('script') || l[ii].includes('link'))
                        $('head').append(l[ii]);
                    ii++;
                }, i * time_out);
            }
            setTimeout(function () {
                header_ready = true;
                if (content_ready && header_ready) {
                    client_ready_call();
                }
            }, (l.length + 1) * time_out);
        }

        function contentGeted(data) {
            $('body').append($(data));
            content_ready = true;
            if (content_ready && header_ready) {
                client_ready_call();
            }
        }


        get_header_and_content(host_links[0]);


    }


</script>


</html>