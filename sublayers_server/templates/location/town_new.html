<style>
    #btn_screen_location_area, #btn_screen_chat_area, #btn_screen_menu_area,
    #btn_1_area, #btn_2_area, #btn_3_area, #btn_4_area {
        cursor: pointer;
    }

    .highlight-buildings {
        cursor: pointer;
    }

    #location-content {
        position: absolute;
        width: 780px;
        height: 690px;
        top: 138px;
        left: 570px;
        pointer-events: none;
    }

    .npc-wrap {
        position: relative;
        width: 100%;
        height: 100%;
    }

    .town-img-mask {
        position: absolute;
        top: 0;
        pointer-events: none;
    }

    #town-out-screen-area {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
    }

    .town-panel {
        position: absolute;
        top: 50px;
        width: 400px;
        height: 400px;
        background-color: rgba(0,150,0,0.25);
    }

    .town-panel.left { left: 100px; }
    .town-panel.right { right: 100px; }

    .town-btn-area {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
    }

    .town-btn-block {
        position: absolute;
        width: 190px;
        height: 50px;
        color: #2ffa00;
        font-size: 24px;
        z-index: 2;
        font-family: Nouveau_IBM;
        letter-spacing: 2px;
        line-height: 20px;
    }
    .town-btn-block.hover { text-shadow: 0 0 1px #00ff00, 0 0 10px #00ff00; }
    .town-btn-block.pressed { color: #082801; text-shadow: none; }
    .town-btn-block.right { text-align: right; }

    #btn_1_text{ top: 589px; left: 276px; transform: rotateZ(-23deg) skew(-9deg); }
    #btn_2_text{ top: 779px; left: 323px; transform: rotateZ(-19deg) skew(-5deg); }
    #btn_3_text{ top: 590px; right: 276px; transform: rotateZ(23deg) skew(9deg); }
    #btn_4_text{ top: 779px; right: 328px; transform: rotateZ(19deg) skew(5deg); }
</style>

<div>
    {% raw svg_code %}
</div>

<div id="location-content">
    {% for building in town.example.buildings %}
        {% set cur_build = town.example.buildings[building] %}
        <div id="building_{{ building }}" class="townPageWrap building-wrap" style="display: none">
            {% include building_window.html %}
        </div>
        {% for npc in cur_build.instances %}
        {% set cur_npc = npc %}
        <div id="npc_{{ npc.node_html() }}" class="townPageWrap npc-wrap" style="display: none">
            {% include npc_window.html %}
        </div>
        {% end %}
    {% end %}
</div>

<div class="town-btn-area">
    <div id="btn_1_text" class="town-btn-block left">Завершить квест</div>
    <div id="btn_2_text" class="town-btn-block left">Отказаться от квеста</div>
    <div id="btn_3_text" class="town-btn-block right"></br>Назад</div>
    <div id="btn_4_text" class="town-btn-block right"></br>Выход</div>
</div>

<img class="town-img-mask" src="static/content/locations/towns/city_mask_1.png"/>

<div id="town-out-screen-area">
    <div id="townLeftPanel" class="town-panel left"></div>
    <div id="townRightPanel" class="town-panel right"></div>
</div>

<img class="town-img-mask" src="static/content/locations/towns/city_mask_2.png"/>

<script>
    var text_variants = [
        '</br>Назад',
        '</br>Выход',
        '</br>Взять квест',
        'Завершить</br>квест',
        'Отказаться</br>от квеста',
        '</br>Купить ТС',
        '</br>Продать ТС',
        '</br>Обменять ТС',
        '</br>Взять ТС',
        '</br>Сменить ТС',
        'Поставить</br>ТС',
        'Подтвердить</br>сделку',
        '</br>Отмена',
        '</br>Применить',
        '</br>Оформить',
        '</br>Продлить',
        '</br>Залить',
        'Залить</br>полный бак',
        '</br>Заправить',
        'Заправить</br>всё',
        '</br>Создать',
        '</br>Принять',
        '</br>Отказаться',
        '</br>Применить',
        'Покинуть</br>группу',
        '</br>Установить'
    ];

    function random_text(){
        var index = Math.floor(Math.random() * text_variants.length);
        return text_variants[index];
    }

    $(function () {
{#        console.log('Вызов установки кликов для города!');#}
        var jq_btn = $('#btn_screen_location_area, #btn_screen_chat_area, #btn_screen_menu_area, #btn_1_area, #btn_2_area, #btn_3_area, #btn_4_area');

        jq_btn
                .mouseenter(function (event) {
                    var id = $(this).attr('id');
                    if (id.indexOf('_area')) {
                        id = id.replace('_area', '');
                        // Проверка доступности кнопок
                        var noactive_status = $('#' + id + '_noactive').css('display');
                        if (noactive_status == undefined || noactive_status.toLowerCase() == 'none') {
                            $('#' + id + '_hover').css('display', 'block');
                            $('#' + id + '_active').css('display', 'none');
                            $('#' + id + '_text').addClass('hover');
                            $('#' + id).css('display', 'none');
                        }
                    }
                })
                .mouseleave(function (event) {
                    var id = $(this).attr('id');
                    if (id.indexOf('_area')) {
                        id = id.replace('_area', '');

                        // Это необходимо сделать вне зависимости от активности кнопки
                        $('#' + id + '_hover').css('display', 'none');
                        $('#' + id + '_pressed').css('display', 'none');
                        $('#' + id + '_text').removeClass('hover');
                        $('#' + id + '_text').removeClass('pressed');

                        // Проверка доступности кнопок
                        var noactive_status = $('#' + id + '_noactive').css('display');
                        if (noactive_status == undefined || noactive_status.toLowerCase() == 'none') {
                            $('#' + id + '_active').css('display', 'block');
                            $('#' + id).css('display', 'block');
                        }
                    }
                })
                .mousedown(function (event) {
                    var id = $(this).attr('id');
                    if (id.indexOf('_area')) {
                        id = id.replace('_area', '');
                        // Проверка доступности кнопок
                        var noactive_status = $('#' + id + '_noactive').css('display');
                        if (noactive_status == undefined || noactive_status.toLowerCase() == 'none') {
                            $('#' + id + '_hover').css('display', 'none');
                            $('#' + id + '_pressed').css('display', 'block');
                            $('#' + id + '_text').addClass('pressed');
                        }
                    }
                })
                .mouseup(function (event) {
                    var id = $(this).attr('id');
                    if (id.indexOf('_area')) {
                        id = id.replace('_area', '');
                        // Проверка доступности кнопок
                        var noactive_status = $('#' + id + '_noactive').css('display');
                        if (noactive_status == undefined || noactive_status.toLowerCase() == 'none') {
                            $('#' + id + '_hover').css('display', 'block');
                            $('#' + id + '_pressed').css('display', 'none');
                            $('#' + id + '_text').removeClass('pressed');
                        }

                        switch (id) {
                            case 'btn_1':
                            case 'btn_2':
                            case 'btn_3':
                            case 'btn_4':
                                locationManager.clickBtn(id.replace('btn_', ''));
                                break;
                            case 'btn_screen_location':
                                console.log('click on btn_screen_location');
                                break;
                            case 'btn_screen_chat':
                                console.log('click on btn_screen_chat');
                                break;
                            case 'btn_screen_menu':
                                console.log('click on btn_screen_menu');
                                break;
                        }
                    }
                });

        // События для зданий
        var jq_buildings = $('.highlight-buildings');
        jq_buildings.click(function(event){
            //console.log('Build click --- > ', this);
            var id = $(this).attr('id');
            var building = $(this).data('building');
            locationManager.openBuilding(building);
{#            console.log('Open ', building);#}
        });

        jq_buildings.mouseenter(function(event){
            //console.log('Build mouseenter --- > ', this);
            var id = $(this).attr('id');
            var index = id.split('_')[1];
            index = index.substr(index.length - 1, 1);
            $("#img_house"+ index +"_on").css("display", "block");
            $("#img_house" + index + "_off").css("display", "none");
            $("#path_h" + index).css("opacity", "0.6");
            $("#path_text_h" + index).css("opacity", "0.6");
        });

        jq_buildings.mouseleave(function(event){
            //console.log('Build mouseleave --- > ', this);
            var id = $(this).attr('id');
            var index = id.split('_')[1];
            index = index.substr(index.length - 1, 1);
            $("#img_house" + index + "_off").css("display", "block");
            $("#img_house" + index + "_on").css("display", "none");
            $("#path_h" + index).css("opacity", "0.2");
            $("#path_text_h" + index).css("opacity", "0.2");
        });
    });
</script>