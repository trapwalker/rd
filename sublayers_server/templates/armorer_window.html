<style>
    #townArmorerPageWrap {
        position: absolute;
        top: 140px;
        left: 592px;
    }

    .armorerWindow-main {
        position: relative;
        width: 734px;
        height: 661px;
        cursor: default;
    }

    .armorer-header {
        position: relative;
        box-sizing: border-box;
        margin-right: auto;
        margin-left: auto;
        width: 692px;
        height: 205px;
        padding-bottom: 6px;
    }

    .armorer-info {
        position: relative;
        width: 170px;
        top: 12px;
        left: 15px;
    }

    .armorer-name {
        position: relative;
        top: 8px;
        text-align: center;
        color: #29F200;
        font: 13pt Nouveau_IBM;
    }

    .armorer-center {
        position: relative;
        box-sizing: border-box;
        margin-right: auto;
        margin-left: auto;
        width: 734px;
        height: 330px;
        padding-bottom: 5px;
    }

    .armorer-car {
        width: 492px;
        height: 100%;
        float: left;
    }

    .armorerSectors {
        width: 242px;
        height: 100%;
        float: left;
    }

    .armorerSectors-slotName {
        box-sizing: border-box;
        padding-top: 15px;
        height: 50px;
        text-align: center;
        color: #29F200;
        font: 11pt Nouveau_IBM;
    }

    .armorerSectors-svg {
        position: relative;
        width: 220px;
        height: 220px;
        margin-left: auto;
        margin-right: auto;
    }

    .armorer-footer {
        position: relative;
        margin-right: auto;
        margin-left: auto;
        width: 606px;
        height: 126px;
    }

    .npcInventory-label {
        box-sizing: border-box;
        padding-left: 70px;
        height: 21px;
        color: #29F200;
        font: 11pt Nouveau_IBM;
    }

    .npcInventory-wrap {
        width: 100%;
        height: 105px;
        overflow-x: scroll;
    }

    .npcInventory-itemWrap {
        box-sizing: border-box;
        margin-right: 10px;
        width: 119px;
        height: 85px;
        float: left;
        opacity: 0.6;
    }

    .npcInventory-itemWrap:hover { opacity: 1; }

    .npcInventory-item {
        position: relative;
        width: 119px;
        height: 85px;
        float: left;
    }

    .npcInventory-name {
        position: absolute;
        padding: 2px 2px 2px 2px;
        font: 10pt Nouveau_IBM;
        color: #135806;
    }

    .npcInventory-pictureWrap {
        position: absolute;
        height: 100%;
        width: 100%;
        background-color: #000000;
        background-image: linear-gradient(45deg, #081b07 25%, transparent 25%, transparent 74%, #081b07 75%, #081b07),
        linear-gradient(45deg, #081b07 25%, transparent 25%, transparent 74%, #081b07 75%, #081b07);
        background-size: 2px 2px;
        background-position: 0 0, 1px 1px;
    }

    .npcInventory-picture {
        position: relative;
        height: 33px;
        width: 62px;
        margin: 35px auto 0px auto;
    }

    .car_sector { opacity: 0.3; }
    .car_sector_hover { opacity: 1; }
    .car_sector_active { opacity: 1; }

</style>

<div class="armorerWindow-main">
    <div class="armorer-header">
        <div class="armorer-info">
            <img class="armorer-foto" src="{{ town.example.armorer.photo }}" alt="Оружейник" />
            <div class="armorer-name"> {{ town.example.armorer.title }} </div>
        </div>
    </div>
    <div class="armorer-center">
        <div class="armorer-car">
            {% raw open(car_svg_link).read() %}
        </div>
        <div class="armorerSectors">
            <div class="armorerSectors-slotName">Имя слота</div>
            <div class="armorerSectors-svg">
                {% raw open(sector_svg_link).read() %}
            </div>
        </div>
    </div>
    <div class="armorer-footer">
        <div class="npcInventory-label">Инвентарь:</div>
        <div class="npcInventory-wrap">
            <div class="npcInventory-inventory"></div>
        </div>
    </div>
</div>

<script>
    /*
    Функция подстраивает ширину инвентаря под его содержимое. Необходимо вызывать
    данную функцию всякий раз когда меняется количество слотов в инвентаре (иначе
    горизонтальный слайдер будер расти вниз)
    */
    function resizeArmorerInventory() {
        var inventory = $(".npcInventory-inventory:first");
        var width = 0;
        if (inventory) {
            $(inventory).find('.npcInventory-itemWrap').each(function (index, element) {
               width += $(element).outerWidth() + parseInt($(element).css('margin-right'));
            });
            $(inventory).width(width);
        }
    }
    resizeArmorerInventory();

    // Подсветка слотов при наведении указателя мыши
    function setSlotOpacity(slot_name, hover) {
        if (hover) {
            $("#top_" + slot_name).addClass("armorer-slot-hover");
            $("#side_" + slot_name).addClass("armorer-slot-hover");
        }
        else {
            $("#top_" + slot_name).removeClass("armorer-slot-hover");
            $("#side_" + slot_name).removeClass("armorer-slot-hover");
        }
    }

    // Подсветка активных слотов
    function dropSlotActive() {
        $('.armorer-slot').removeClass("armorer-slot-active");
    }

    function setSlotActive(slot_name) {
        console.log('+')
        $("#top_" + slot_name).addClass("armorer-slot-active");
        $("#side_" + slot_name).addClass("armorer-slot-active");
    }

    {% for slot in car_slots %}
    $("#top_{{slot}}").mouseenter(function() {
        setSlotOpacity("{{slot}}", true);
    });
    $("#side_{{slot}}").mouseenter(function() {
        setSlotOpacity("{{slot}}", true);
    });

    $("#top_{{slot}}").mouseleave(function() {
        setSlotOpacity("{{slot}}", false);
    });
    $("#side_{{slot}}").mouseleave(function() {
        setSlotOpacity("{{slot}}", false);
    });

    $("#top_{{slot}}").click(function() {
        locationManager.armorer.setActiveSlot("{{slot}}");
    });
    $("#side_{{slot}}").click(function() {
        locationManager.armorer.setActiveSlot("{{slot}}");
    });

    {% end %}
    // Подсветка секторов

    function addClassSVG(obj, cls) {
        var oldClass = obj.attr('class');
        if (!oldClass) oldClass = cls;
        oldClass= oldClass.toString();
        if (oldClass.indexOf(cls) == -1) oldClass += ' ' + cls;
        obj.attr('class', oldClass);
    }

    function removeClassSVG(obj, cls) {
        var oldClass = obj.attr('class');
        if (!oldClass) return;
        oldClass = oldClass.toString();
        oldClass = oldClass.replace(cls, '');
        obj.attr('class', oldClass);
    }

    function dropSectorActive() {
        removeClassSVG($("#sector_front"), 'car_sector_active');
        removeClassSVG($("#sector_back"), 'car_sector_active');
        removeClassSVG($("#sector_left"), 'car_sector_active');
        removeClassSVG($("#sector_right"), 'car_sector_active');
    }

    function setSectorActive(sectorName) {
        addClassSVG($("#sector_" + sectorName), 'car_sector_active');
    }

    {% for sector in ['front', 'back', 'left', 'right'] %}
    $("#sector_{{sector}}").mouseenter(function() {
        addClassSVG($("#sector_{{sector}}"), 'car_sector_hover');
    });
    $("#sector_{{sector}}").mouseleave(function() {
        removeClassSVG($("#sector_{{sector}}"), 'car_sector_hover');
    });
    $("#sector_{{sector}}").click(function() {
        console.log('{{sector}}')
        locationManager.armorer.setActiveSector("{{sector}}");
    });

    {% end %}
</script>
